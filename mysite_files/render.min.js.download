"use strict";define("render",["lodash","zepto","coreUtils","utils","core","wixUrlParser","reactDOM","experiment","animations","tweenEngine","TweenMax","TimelineMax","ScrollToPlugin","DrawSVGPlugin"],function(e,r,i,n,a,t,s,o,d,w,c,l){function u(e,r){window.clientSideRender?r&&r():requirejs(["warmup"],function(r){e(r)})}function p(e){r("#SITE_CONTAINER").attr("data-santa-render-status",e)}function S(e,r){var i=r.query,n=(e[i.configName||"fullFunctionality"]||e.fullFunctionality).getConfig();if(!i.dsOrigin)throw new Error("You must define dsOrigin parameter in order to use the documentServices - please speak to html-server team for a key");return n.origin=i.dsOrigin,n}function f(r,i,a){var t=e(a).keys().pull("masterPage").value();return e.mapValues(a,function(e,a){return i&&window.pagesData&&window.pagesData[a]?e:n.dataFixer.fix(e,t.slice(),r.requestModel,r.currentUrl,r.urlFormatModel,"site"===r.viewMode,r.rendererModel)})}function v(e,r,i,a){n.ajaxLibrary.ajax({type:"POST",url:"https://jy75p2avi1.execute-api.us-west-2.amazonaws.com/prod/logDiffs",dataType:"json",headers:{"x-api-key":"NrelGcqXZH9pIBYc3zjA77SIpiBKUkp643H7P41F"},data:{vsi:a,santaVersion:i,url:window.location.href,ssrDiverge:{clientMarkup:e,serverMarkup:r}}})}function g(r,i,n,t,o){u(function(e){e.willRender(i)}),window.clientSideRender&&window.santaRenderingError&&window.parent&&window.parent.postMessage({santaRenderingError:window.santaRenderingError.errorInfo},"*");var d=window.document.getElementById("SITE_CONTAINER").children[0];t.onBeforeLayout=function(){var e=window.document.getElementById("SITE_CONTAINER").children[0],r=e.innerHTML;window.sssr.clientSantaVersion=e.getAttribute("data-santa-version"),u(function(n){window.sssr.success=d===e,p(window.sssr.success?"SUCCESS":"DIVERGE"),window.sssr.clientSideRender={sinceInitialTimestamp:Date.now()-window.wixBiSession.initialTimestamp,performanceNow:M()},window.parent&&(window.sssr.success?window.parent.postMessage("sssrSuccess","*"):(window.sssr.clientSantaVersion!==window.sssr.serverSantaVersion&&(r=window.sssr.clientSantaVersion,window.sssr.serverMarkup=window.sssr.serverSantaVersion),window.sssr.clientMarkup=r,window.sssr.serverMarkup=window.sssr.serverMarkup||d.outerHTML,window.parent.postMessage({sssrFail:{clientMarkup:window.sssr.clientMarkup,serverMarkup:window.sssr.serverMarkup}},"*"),v(window.sssr.clientMarkup,window.sssr.serverMarkup,window.sssr.clientSantaVersion,i.wixBiSession.viewerSessionId))),n.didRender(i)},function(){p("CLIENT")})},a.renderer.renderSite(i,n,t,function(i){window.rendered?window.rendered.forceUpdate():(window.rendered=s.render(i,window.document.getElementById("SITE_CONTAINER")),window.onpopstate=window.rendered.onPopState,window.onhashchange=window.rendered.onHashChange,window.parent!==window&&requirejs(["santaPreview"],function(e){window.rendered.registerAspectToEvent("siteReady",function(){o&&o(window.rendered),window.documentServices&&(window.parent.postMessage("documentServicesLoaded","*"),window.createSantaPreview=e)})}),r.qaAutomation&&(e.set(window,"testApi.domSelectors",r.qaAutomation.getDomSelectors(r.react,r.reactDOM)),window.testApi.domSelectors.setSearchRoot(window.rendered),e.set(window,"testApi.isReady",!0)))})}function m(r,t,s){var o={};i.urlUtils.isQueryParamOn(s.currentUrl,"isSantaEditor")&&(o=e.assign(o,{componentViewMode:"editor"})),s.rendererModel.previewMode&&(o=e.assign(o,{isSocialInteractionAllowed:!1,isPlayingAllowed:!1})),s.renderFlags=e.assign({},s.renderFlags,o);var u=new n.FullSiteData(s);u.updateScreenSize();var p=w.create(c,l);u.animations=d.create(p);var S=a.SiteDataAPI.createSiteDataAPIAndDal(u,t),f=S.siteData,v=S.siteDataAPI;return{fullSiteData:u,displayedSiteData:f,siteDataWrapper:S,viewerPrivateServices:{pointers:S.pointers,displayedDAL:S.displayedDal,siteDataAPI:v},isServerSideRender:f.isClientAfterSSR(),siteModel:s,siteDataAPI:v}}function D(r,i){e.forOwn(i,function(e){r.createDisplayedPage(e.structure.id)})}function y(r,i,a,s,d){var w=m(r,i,a),c=r.documentServices;try{c&&e.isUndefined(window.karmaIntegration)&&o.isOpen("sv_fullstory",a)&&n.integrations.fullStory.start(a)}catch(e){}if(c)w.siteDataWrapper.dataLoadedRegistrar=w.siteDataAPI.registerDataLoadedCallback.bind(w.siteDataAPI),window.documentServices=new c.Site(S(c.configs,w.siteModel.currentUrl),w.siteDataWrapper,e.partial(f,w.siteModel,w.isServerSideRender),e.partial(g,r,w.displayedSiteData,w.viewerPrivateServices,s),e.partial(D,w.siteDataAPI)),e.set(window,"testApi.documentServices",window.documentServices);else{var l=w.siteDataWrapper.fullPagesData.pagesData;if(l&&(f(w.siteModel,w.isServerSideRender,l),l.masterPage)){w.siteDataAPI.createDisplayedPage("masterPage");var u=t.parseUrl(w.displayedSiteData,w.displayedSiteData.currentUrl.full);w.displayedSiteData.setRootNavigationInfo(u),w.siteDataAPI.createDisplayedPage(u.pageId)}g(r,w.displayedSiteData,w.viewerPrivateServices,s,d)}}var M=Object.freeze("undefined"!=typeof window&&window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now.bind(Date));return{clientSide:y}});
//# sourceMappingURL=render.min.js.map